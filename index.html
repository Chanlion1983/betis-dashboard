<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard PRO Real Betis Balompi√©</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #00A651 0%, #008040 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Login Screen */
        .login-screen {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            margin: 100px auto;
        }

        .login-screen.hidden { display: none; }

        .lock-icon {
            font-size: 48px;
            text-align: center;
            margin-bottom: 20px;
        }

        .login-title {
            text-align: center;
            color: #00A651;
            margin-bottom: 30px;
            font-size: 28px;
        }

        .password-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 15px;
        }

        .password-input:focus {
            outline: none;
            border-color: #00A651;
        }

        .login-button {
            width: 100%;
            padding: 15px;
            background: #00A651;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .login-button:hover { background: #008040; }

        /* Dashboard */
        .dashboard {
            display: none;
        }

        .dashboard.show {
            display: block;
        }

        /* Header */
        .header {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 30px;
        }

        .header-text {
            flex: 1;
        }

        .header h1 {
            color: #00A651;
            font-size: 42px;
            margin-bottom: 10px;
        }

        .header .subtitle {
            color: #666;
            font-size: 18px;
        }

        .update-info {
            color: #999;
            font-size: 14px;
            margin-top: 10px;
        }

        .antony-photo {
            text-align: center;
        }

        .antony-photo img {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 5px solid #00A651;
            object-fit: cover;
            box-shadow: 0 5px 15px rgba(0, 166, 81, 0.3);
        }

        .antony-caption {
            margin-top: 10px;
            font-weight: bold;
            color: #00A651;
            font-size: 14px;
        }

        .logout-button {
            background: #ff6b6b;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 20px;
        }

        .logout-button:hover { background: #ff5252; }

        /* Tabs */
        .tabs {
            background: white;
            border-radius: 15px;
            padding: 10px;
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .tab-button {
            flex: 1;
            min-width: 150px;
            padding: 15px 20px;
            background: #f5f5f5;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            color: #666;
            transition: all 0.3s;
        }

        .tab-button:hover {
            background: #e0e0e0;
        }

        .tab-button.active {
            background: #00A651;
            color: white;
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        /* Cards */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .card-title {
            color: #00A651;
            font-size: 24px;
            margin-bottom: 20px;
            border-bottom: 3px solid #00A651;
            padding-bottom: 10px;
            font-weight: bold;
        }

        /* Match Cards */
        .match {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: #f5f5f5;
            border-radius: 10px;
            border-left: 4px solid #00A651;
        }

        .match.win {
            background: #d4edda;
            border-left-color: #28a745;
        }

        .match.draw {
            background: #fff3cd;
            border-left-color: #ffc107;
        }

        .match.loss {
            background: #f8d7da;
            border-left-color: #dc3545;
        }

        .match-teams {
            flex: 1;
            font-weight: bold;
            color: #333;
        }

        .match-score {
            font-size: 20px;
            font-weight: bold;
            margin: 0 15px;
            color: #00A651;
        }

        .match-date {
            color: #666;
            font-size: 12px;
        }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .stat-item {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 36px;
            font-weight: bold;
            color: #00A651;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
        }

        /* Streak */
        .streak-display {
            text-align: center;
            padding: 20px;
        }

        .streak-text {
            font-size: 32px;
            font-weight: bold;
            color: #00A651;
            margin-bottom: 10px;
        }

        .streak-badges {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .streak-badge {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: white;
        }

        .streak-badge.win { background: #28a745; }
        .streak-badge.draw { background: #ffc107; }
        .streak-badge.loss { background: #dc3545; }

        /* Table */
        .table-row {
            display: flex;
            justify-content: space-between;
            padding: 12px;
            border-bottom: 1px solid #eee;
        }

        .table-row:hover { background: #f5f5f5; }

        .table-row.betis {
            background: #d4edda;
            font-weight: bold;
        }

        .table-pos {
            width: 30px;
            text-align: center;
            font-weight: bold;
            color: #00A651;
        }

        .table-team {
            flex: 1;
            padding-left: 10px;
        }

        .table-stats {
            display: flex;
            gap: 15px;
            color: #666;
            font-size: 14px;
        }

        /* Player Card */
        .player-card {
            background: #f5f5f5;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .player-photo {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #00A651;
        }

        .player-info {
            flex: 1;
        }

        .player-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .player-stats {
            color: #666;
            font-size: 14px;
        }

        /* Loading & Error */
        .loading {
            text-align: center;
            color: white;
            font-size: 20px;
            margin-top: 50px;
        }

        .loading.hidden { display: none; }

        .error {
            background: #ff4444;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .error.hidden { display: none; }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
            }

            .grid {
                grid-template-columns: 1fr;
            }

            .tabs {
                flex-direction: column;
            }

            .tab-button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="lock-icon">‚öΩ</div>
        <h2 class="login-title">Dashboard PRO Real Betis</h2>
        <input
            type="password"
            id="passwordInput"
            class="password-input"
            placeholder="Ingresa la contrase√±a"
            onkeypress="if(event.key==='Enter') login()"
        >
        <button class="login-button" onclick="login()">Acceder</button>
        <div class="error hidden" id="loginError">Contrase√±a incorrecta</div>
    </div>

    <!-- Dashboard -->
    <div class="container">
        <div class="dashboard" id="dashboard">
            <div class="header">
                <div class="header-content">
                    <div class="header-text">
                        <h1>‚öΩ Real Betis Balompi√©</h1>
                        <p class="subtitle">Dashboard PRO - Temporada 2024/2025</p>
                        <p class="update-info">√öltima actualizaci√≥n: <span id="lastUpdate">-</span></p>
                    </div>
                    <div class="antony-photo">
                        <img src="antony_dos_santos.jpg" alt="Antony dos Santos" onerror="this.style.display='none'">
                        <p class="antony-caption">üêê LA CABRA</p>
                    </div>
                </div>
                <button class="logout-button" onclick="logout()">Cerrar Sesi√≥n</button>
            </div>

            <div class="loading" id="loading">Cargando datos del Betis...</div>
            <div class="error hidden" id="error">Error al cargar datos.</div>

            <!-- Tabs -->
            <div class="tabs">
                <button class="tab-button active" onclick="showTab('resumen')">üìä Resumen</button>
                <button class="tab-button" onclick="showTab('estadisticas')">‚öΩ Estad√≠sticas</button>
                <button class="tab-button" onclick="showTab('calendario')">üìÖ Calendario</button>
                <button class="tab-button" onclick="showTab('analisis')">üìà An√°lisis</button>
                <button class="tab-button" onclick="showTab('equipo')">üë• Equipo</button>
                <button class="tab-button" onclick="showTab('curiosidades')">üé≤ Curiosidades</button>
            </div>

            <!-- Tab: Resumen -->
            <div id="tab-resumen" class="tab-content active">
                <div class="card" style="margin-bottom: 20px;">
                    <h2 class="card-title">üî• Racha Actual</h2>
                    <div id="streak" class="streak-display"></div>
                </div>

                <div class="grid">
                    <div class="card">
                        <h2 class="card-title">√öltimos Resultados</h2>
                        <div id="lastMatches"></div>
                    </div>

                    <div class="card">
                        <h2 class="card-title">Estad√≠sticas Temporada</h2>
                        <div class="stats-grid" id="seasonStats"></div>
                    </div>

                    <div class="card">
                        <h2 class="card-title">Pr√≥ximos Partidos</h2>
                        <div id="nextMatches"></div>
                    </div>

                    <div class="card">
                        <h2 class="card-title">Tabla La Liga (Top 10)</h2>
                        <div id="standings"></div>
                    </div>
                </div>
            </div>

            <!-- Tab: Estad√≠sticas -->
            <div id="tab-estadisticas" class="tab-content">
                <div class="grid">
                    <div class="card">
                        <h2 class="card-title">‚öΩ Top Goleadores</h2>
                        <div id="topScorers"></div>
                    </div>

                    <div class="card">
                        <h2 class="card-title">üè† Casa vs Visitante</h2>
                        <div id="homeAway"></div>
                    </div>

                    <div class="card">
                        <h2 class="card-title">üìä Promedios</h2>
                        <div id="averages"></div>
                    </div>

                    <div class="card">
                        <h2 class="card-title">üî¥ Disciplina</h2>
                        <div id="discipline"></div>
                    </div>
                </div>
            </div>

            <!-- Tab: Calendario -->
            <div id="tab-calendario" class="tab-content">
                <div class="card">
                    <h2 class="card-title">üìÖ Todos los Partidos</h2>
                    <div id="fullCalendar"></div>
                </div>
            </div>

            <!-- Tab: An√°lisis -->
            <div id="tab-analisis" class="tab-content">
                <div class="grid">
                    <div class="card">
                        <h2 class="card-title">üìà Forma Reciente (10 partidos)</h2>
                        <div id="recentForm"></div>
                    </div>

                    <div class="card">
                        <h2 class="card-title">üèÜ Rachas de la Temporada</h2>
                        <div id="seasonStreaks"></div>
                    </div>

                    <div class="card">
                        <h2 class="card-title">‚öîÔ∏è vs Pr√≥ximo Rival</h2>
                        <div id="nextRivalHistory"></div>
                    </div>

                    <div class="card">
                        <h2 class="card-title">üìä Comparaci√≥n Temporadas</h2>
                        <div id="seasonComparison"></div>
                    </div>
                </div>
            </div>

            <!-- Tab: Equipo -->
            <div id="tab-equipo" class="tab-content">
                <div class="card">
                    <h2 class="card-title">üë• Informaci√≥n del Club</h2>
                    <div id="teamInfo"></div>
                </div>
            </div>

            <!-- Tab: Curiosidades -->
            <div id="tab-curiosidades" class="tab-content">
                <div class="card">
                    <h2 class="card-title">üé≤ R√©cords y Curiosidades</h2>
                    <div id="curiosities"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const CORRECT_PASSWORD = 'betis2025';
        const BETIS_TEAM_ID = '133722';
        const LALIGA_ID = '4335';
        const CURRENT_SEASON = '2024-2025';
        const PREVIOUS_SEASON = '2023-2024';
        const AUTO_REFRESH_INTERVAL = 5 * 60 * 1000;
        let autoRefreshTimer = null;
        let allMatches = [];

        window.addEventListener('load', function() {
            if (sessionStorage.getItem('authenticated') === 'true') {
                showDashboard();
            }
        });

        function login() {
            const password = document.getElementById('passwordInput').value;
            const loginError = document.getElementById('loginError');

            if (password === CORRECT_PASSWORD) {
                sessionStorage.setItem('authenticated', 'true');
                showDashboard();
                document.getElementById('passwordInput').value = '';
                loginError.classList.add('hidden');
            } else {
                loginError.classList.remove('hidden');
            }
        }

        function logout() {
            sessionStorage.removeItem('authenticated');
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('dashboard').classList.remove('show');
            if (autoRefreshTimer) {
                clearInterval(autoRefreshTimer);
            }
        }

        function showDashboard() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('dashboard').classList.add('show');
            loadDashboardData();

            if (autoRefreshTimer) clearInterval(autoRefreshTimer);
            autoRefreshTimer = setInterval(loadDashboardData, AUTO_REFRESH_INTERVAL);
        }

        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            document.getElementById('tab-' + tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function updateLastUpdateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('lastUpdate').textContent = timeString;
        }

        async function loadDashboardData() {
            showLoading();
            hideError();

            try {
                await Promise.all([
                    loadAllMatches(),
                    loadStandings(),
                    loadTeamInfo()
                ]);
                updateLastUpdateTime();
                hideLoading();
            } catch (error) {
                console.error('Error:', error);
                showError('Error al cargar datos.');
                hideLoading();
            }
        }

        async function loadAllMatches() {
            try {
                // Load last 15 matches
                const lastResponse = await fetch(
                    `https://www.thesportsdb.com/api/v1/json/3/eventslast.php?id=${BETIS_TEAM_ID}`
                );
                const lastData = await lastResponse.json();

                // Load next matches
                const nextResponse = await fetch(
                    `https://www.thesportsdb.com/api/v1/json/3/eventsnext.php?id=${BETIS_TEAM_ID}`
                );
                const nextData = await nextResponse.json();

                const lastMatches = lastData.results || [];
                const nextMatches = nextData.events || [];

                allMatches = {
                    last: lastMatches.filter(m => m.strLeague === 'Spanish La Liga' || m.strLeague === 'UEFA Europa League'),
                    next: nextMatches.filter(m => m.strLeague === 'Spanish La Liga')
                };

                // Populate all sections
                populateResumen();
                populateEstadisticas();
                populateCalendario();
                populateAnalisis();
                populateCuriosidades();
            } catch (error) {
                console.error('Error loading matches:', error);
            }
        }

        async function loadStandings() {
            try {
                const response = await fetch(
                    `https://www.thesportsdb.com/api/v1/json/3/lookuptable.php?l=${LALIGA_ID}&s=${CURRENT_SEASON}`
                );
                const data = await response.json();

                if (data.table && data.table.length > 0) {
                    displayStandings(data.table);
                }
            } catch (error) {
                console.error('Error loading standings:', error);
            }
        }

        async function loadTeamInfo() {
            try {
                const response = await fetch(
                    `https://www.thesportsdb.com/api/v1/json/3/lookupteam.php?id=${BETIS_TEAM_ID}`
                );
                const data = await response.json();

                if (data.teams && data.teams[0]) {
                    displayTeamInfo(data.teams[0]);
                }
            } catch (error) {
                console.error('Error loading team info:', error);
            }
        }

        function populateResumen() {
            const last5 = allMatches.last.slice(0, 5);
            const next3 = allMatches.next.slice(0, 3);

            displayLastMatches(last5, 'lastMatches');
            displayNextMatches(next3, 'nextMatches');
            calculateAndDisplayStats(last5);
        }

        function populateEstadisticas() {
            calculateHomeAway();
            calculateAverages();
            calculateDiscipline();
            // Top scorers would need player-specific API calls
            document.getElementById('topScorers').innerHTML = '<p style="text-align: center; color: #666;">Datos de jugadores no disponibles en API gratuita</p>';
        }

        function populateCalendario() {
            const allLaLigaMatches = [...allMatches.last, ...allMatches.next].filter(m => m.strLeague === 'Spanish La Liga');
            displayFullCalendar(allLaLigaMatches);
        }

        function populateAnalisis() {
            const last10 = allMatches.last.slice(0, 10);
            displayRecentForm(last10);
            calculateSeasonStreaks();
            displayNextRivalHistory();
            displaySeasonComparison();
        }

        function populateCuriosidades() {
            calculateCuriosities();
        }

        function displayLastMatches(matches, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            matches.forEach(match => {
                const homeTeam = match.strHomeTeam;
                const awayTeam = match.strAwayTeam;
                const homeScore = match.intHomeScore || '?';
                const awayScore = match.intAwayScore || '?';
                const date = new Date(match.dateEvent).toLocaleDateString('es-ES');

                let result = '';
                const isBetisHome = homeTeam === 'Real Betis';

                if (homeScore !== '?' && awayScore !== '?') {
                    if (homeScore > awayScore) {
                        result = isBetisHome ? 'win' : 'loss';
                    } else if (homeScore < awayScore) {
                        result = isBetisHome ? 'loss' : 'win';
                    } else {
                        result = 'draw';
                    }
                }

                container.innerHTML += `
                    <div class="match ${result}">
                        <div>
                            <div class="match-teams">${homeTeam} vs ${awayTeam}</div>
                            <div class="match-date">${date} - ${match.strLeague}</div>
                        </div>
                        <div class="match-score">${homeScore} - ${awayScore}</div>
                    </div>
                `;
            });
        }

        function displayNextMatches(matches, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            if (matches.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">No hay pr√≥ximos partidos programados</p>';
                return;
            }

            matches.forEach(match => {
                const homeTeam = match.strHomeTeam;
                const awayTeam = match.strAwayTeam;
                const date = new Date(match.dateEvent).toLocaleDateString('es-ES');
                const time = match.strTime || 'Por confirmar';

                container.innerHTML += `
                    <div class="match">
                        <div>
                            <div class="match-teams">${homeTeam} vs ${awayTeam}</div>
                            <div class="match-date">${date} - ${time}</div>
                        </div>
                    </div>
                `;
            });
        }

        function calculateAndDisplayStats(matches) {
            let wins = 0, draws = 0, losses = 0, goals = 0;
            let results = [];

            matches.forEach(match => {
                const isBetisHome = match.strHomeTeam === 'Real Betis';
                const homeScore = parseInt(match.intHomeScore) || 0;
                const awayScore = parseInt(match.intAwayScore) || 0;

                let result = '';
                if (isBetisHome) {
                    goals += homeScore;
                    if (homeScore > awayScore) {
                        wins++;
                        result = 'win';
                    } else if (homeScore === awayScore) {
                        draws++;
                        result = 'draw';
                    } else {
                        losses++;
                        result = 'loss';
                    }
                } else {
                    goals += awayScore;
                    if (awayScore > homeScore) {
                        wins++;
                        result = 'win';
                    } else if (awayScore === homeScore) {
                        draws++;
                        result = 'draw';
                    } else {
                        losses++;
                        result = 'loss';
                    }
                }
                results.push(result);
            });

            displaySeasonStats({ wins, draws, losses, goals, played: matches.length });
            displayStreak(results);
        }

        function displaySeasonStats(stats) {
            const container = document.getElementById('seasonStats');
            container.innerHTML = `
                <div class="stat-item">
                    <div class="stat-value">${stats.wins}</div>
                    <div class="stat-label">Victorias (√∫ltimos 5)</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${stats.draws}</div>
                    <div class="stat-label">Empates (√∫ltimos 5)</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${stats.goals}</div>
                    <div class="stat-label">Goles (√∫ltimos 5)</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${stats.played}</div>
                    <div class="stat-label">Partidos</div>
                </div>
            `;
        }

        function displayStreak(results) {
            const container = document.getElementById('streak');

            let currentStreak = 0;
            let streakType = results[results.length - 1];

            for (let i = results.length - 1; i >= 0; i--) {
                if (results[i] === streakType) {
                    currentStreak++;
                } else {
                    break;
                }
            }

            const streakText = {
                'win': `${currentStreak} victoria${currentStreak > 1 ? 's' : ''} consecutiva${currentStreak > 1 ? 's' : ''}`,
                'draw': `${currentStreak} empate${currentStreak > 1 ? 's' : ''} consecutivo${currentStreak > 1 ? 's' : ''}`,
                'loss': `${currentStreak} derrota${currentStreak > 1 ? 's' : ''} consecutiva${currentStreak > 1 ? 's' : ''}`
            };

            const badges = results.reverse().map(result => {
                const emoji = { 'win': 'V', 'draw': 'E', 'loss': 'D' };
                return `<div class="streak-badge ${result}">${emoji[result]}</div>`;
            }).join('');

            container.innerHTML = `
                <div class="streak-text">${streakText[streakType]}</div>
                <div class="streak-badges">${badges}</div>
            `;
        }

        function displayStandings(standings) {
            const container = document.getElementById('standings');
            container.innerHTML = '';

            standings.sort((a, b) => parseInt(a.intRank) - parseInt(b.intRank));

            standings.slice(0, 10).forEach(team => {
                const isBetis = team.strTeam === 'Real Betis';
                container.innerHTML += `
                    <div class="table-row ${isBetis ? 'betis' : ''}">
                        <div class="table-pos">${team.intRank}</div>
                        <div class="table-team">${team.strTeam}</div>
                        <div class="table-stats">
                            <span>PJ: ${team.intPlayed}</span>
                            <span>Pts: ${team.intPoints}</span>
                        </div>
                    </div>
                `;
            });
        }

        function calculateHomeAway() {
            const container = document.getElementById('homeAway');
            let homeWins = 0, homeDraws = 0, homeLosses = 0, homeGoals = 0;
            let awayWins = 0, awayDraws = 0, awayLosses = 0, awayGoals = 0;

            allMatches.last.forEach(match => {
                const isBetisHome = match.strHomeTeam === 'Real Betis';
                const homeScore = parseInt(match.intHomeScore) || 0;
                const awayScore = parseInt(match.intAwayScore) || 0;

                if (isBetisHome) {
                    homeGoals += homeScore;
                    if (homeScore > awayScore) homeWins++;
                    else if (homeScore === awayScore) homeDraws++;
                    else homeLosses++;
                } else {
                    awayGoals += awayScore;
                    if (awayScore > homeScore) awayWins++;
                    else if (awayScore === homeScore) awayDraws++;
                    else awayLosses++;
                }
            });

            container.innerHTML = `
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value">${homeWins}</div>
                        <div class="stat-label">Victorias Casa</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${awayWins}</div>
                        <div class="stat-label">Victorias Visitante</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${homeGoals}</div>
                        <div class="stat-label">Goles Casa</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${awayGoals}</div>
                        <div class="stat-label">Goles Visitante</div>
                    </div>
                </div>
            `;
        }

        function calculateAverages() {
            const container = document.getElementById('averages');
            let goalsFor = 0, goalsAgainst = 0;
            let matches = allMatches.last.length;

            allMatches.last.forEach(match => {
                const isBetisHome = match.strHomeTeam === 'Real Betis';
                const homeScore = parseInt(match.intHomeScore) || 0;
                const awayScore = parseInt(match.intAwayScore) || 0;

                if (isBetisHome) {
                    goalsFor += homeScore;
                    goalsAgainst += awayScore;
                } else {
                    goalsFor += awayScore;
                    goalsAgainst += homeScore;
                }
            });

            const avgFor = (goalsFor / matches).toFixed(1);
            const avgAgainst = (goalsAgainst / matches).toFixed(1);

            container.innerHTML = `
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value">${avgFor}</div>
                        <div class="stat-label">Goles a Favor/Partido</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${avgAgainst}</div>
                        <div class="stat-label">Goles en Contra/Partido</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${goalsFor}</div>
                        <div class="stat-label">Total Goles a Favor</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${goalsAgainst}</div>
                        <div class="stat-label">Total Goles en Contra</div>
                    </div>
                </div>
            `;
        }

        function calculateDiscipline() {
            const container = document.getElementById('discipline');
            container.innerHTML = `
                <p style="text-align: center; color: #666; padding: 20px;">
                    Datos de tarjetas no disponibles en API gratuita.<br>
                    Esta informaci√≥n requiere una API de pago.
                </p>
            `;
        }

        function displayFullCalendar(matches) {
            const container = document.getElementById('fullCalendar');
            container.innerHTML = '';

            if (matches.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">No hay datos de calendario</p>';
                return;
            }

            matches.forEach(match => {
                const homeTeam = match.strHomeTeam;
                const awayTeam = match.strAwayTeam;
                const homeScore = match.intHomeScore || '-';
                const awayScore = match.intAwayScore || '-';
                const date = new Date(match.dateEvent).toLocaleDateString('es-ES');
                const isBetisHome = homeTeam === 'Real Betis';

                let result = '';
                if (homeScore !== '-' && awayScore !== '-') {
                    if (homeScore > awayScore) {
                        result = isBetisHome ? 'win' : 'loss';
                    } else if (homeScore < awayScore) {
                        result = isBetisHome ? 'loss' : 'win';
                    } else {
                        result = 'draw';
                    }
                }

                container.innerHTML += `
                    <div class="match ${result}" style="margin-bottom: 10px;">
                        <div>
                            <div class="match-teams">${homeTeam} vs ${awayTeam}</div>
                            <div class="match-date">${date}</div>
                        </div>
                        <div class="match-score">${homeScore} - ${awayScore}</div>
                    </div>
                `;
            });
        }

        function displayRecentForm(matches) {
            const container = document.getElementById('recentForm');
            displayLastMatches(matches, 'recentForm');
        }

        function calculateSeasonStreaks() {
            const container = document.getElementById('seasonStreaks');
            // Calculate best and worst streaks
            let maxWinStreak = 0, currentWinStreak = 0;
            let maxLossStreak = 0, currentLossStreak = 0;
            let maxUnbeaten = 0, currentUnbeaten = 0;

            allMatches.last.forEach(match => {
                const isBetisHome = match.strHomeTeam === 'Real Betis';
                const homeScore = parseInt(match.intHomeScore) || 0;
                const awayScore = parseInt(match.intAwayScore) || 0;

                let isWin = false, isLoss = false;

                if (isBetisHome) {
                    isWin = homeScore > awayScore;
                    isLoss = homeScore < awayScore;
                } else {
                    isWin = awayScore > homeScore;
                    isLoss = awayScore < homeScore;
                }

                if (isWin) {
                    currentWinStreak++;
                    currentUnbeaten++;
                    currentLossStreak = 0;
                    maxWinStreak = Math.max(maxWinStreak, currentWinStreak);
                } else if (isLoss) {
                    currentLossStreak++;
                    currentWinStreak = 0;
                    currentUnbeaten = 0;
                    maxLossStreak = Math.max(maxLossStreak, currentLossStreak);
                } else {
                    currentWinStreak = 0;
                    currentLossStreak = 0;
                    currentUnbeaten++;
                }

                maxUnbeaten = Math.max(maxUnbeaten, currentUnbeaten);
            });

            container.innerHTML = `
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value">${maxWinStreak}</div>
                        <div class="stat-label">Mayor Racha de Victorias</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${maxUnbeaten}</div>
                        <div class="stat-label">Mayor Racha Invicto</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${maxLossStreak}</div>
                        <div class="stat-label">Mayor Racha de Derrotas</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${allMatches.last.length}</div>
                        <div class="stat-label">Partidos Analizados</div>
                    </div>
                </div>
            `;
        }

        function displayNextRivalHistory() {
            const container = document.getElementById('nextRivalHistory');

            if (!allMatches.next || allMatches.next.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">No hay pr√≥ximo rival programado</p>';
                return;
            }

            const nextMatch = allMatches.next[0];
            const rival = nextMatch.strHomeTeam === 'Real Betis' ? nextMatch.strAwayTeam : nextMatch.strHomeTeam;

            container.innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <h3 style="color: #00A651; margin-bottom: 20px;">Pr√≥ximo Rival: ${rival}</h3>
                    <p style="color: #666;">Historial espec√≠fico no disponible en API gratuita</p>
                    <p style="color: #666; margin-top: 10px;">Fecha: ${new Date(nextMatch.dateEvent).toLocaleDateString('es-ES')}</p>
                </div>
            `;
        }

        function displaySeasonComparison() {
            const container = document.getElementById('seasonComparison');
            container.innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <p style="color: #666;">Comparaci√≥n con temporada anterior no disponible</p>
                    <p style="color: #666; margin-top: 10px;">Se requiere acceso a datos hist√≥ricos completos</p>
                </div>
            `;
        }

        function calculateCuriosities() {
            const container = document.getElementById('curiosities');
            let maxGoalsFor = 0, maxGoalsAgainst = 0;
            let biggestWin = null, biggestLoss = null;

            allMatches.last.forEach(match => {
                const isBetisHome = match.strHomeTeam === 'Real Betis';
                const homeScore = parseInt(match.intHomeScore) || 0;
                const awayScore = parseInt(match.intAwayScore) || 0;

                const betisGoals = isBetisHome ? homeScore : awayScore;
                const rivalGoals = isBetisHome ? awayScore : homeScore;

                maxGoalsFor = Math.max(maxGoalsFor, betisGoals);
                maxGoalsAgainst = Math.max(maxGoalsAgainst, rivalGoals);

                const diff = betisGoals - rivalGoals;
                if (diff > 0 && (!biggestWin || diff > biggestWin.diff)) {
                    biggestWin = { match, diff, betisGoals, rivalGoals };
                }
                if (diff < 0 && (!biggestLoss || diff < biggestLoss.diff)) {
                    biggestLoss = { match, diff: Math.abs(diff), betisGoals, rivalGoals };
                }
            });

            let html = '<div style="padding: 20px;">';

            html += `<div style="margin-bottom: 20px; padding: 15px; background: #d4edda; border-radius: 10px;">
                <h3 style="color: #00A651; margin-bottom: 10px;">üéØ Goles en un Partido</h3>
                <p><strong>M√°ximo goles marcados:</strong> ${maxGoalsFor}</p>
                <p><strong>M√°ximo goles recibidos:</strong> ${maxGoalsAgainst}</p>
            </div>`;

            if (biggestWin) {
                const match = biggestWin.match;
                html += `<div style="margin-bottom: 20px; padding: 15px; background: #d4edda; border-radius: 10px;">
                    <h3 style="color: #00A651; margin-bottom: 10px;">üèÜ Mayor Goleada a Favor</h3>
                    <p><strong>${match.strHomeTeam} ${match.intHomeScore} - ${match.intAwayScore} ${match.strAwayTeam}</strong></p>
                    <p>Diferencia: ${biggestWin.diff} goles</p>
                </div>`;
            }

            if (biggestLoss) {
                const match = biggestLoss.match;
                html += `<div style="margin-bottom: 20px; padding: 15px; background: #f8d7da; border-radius: 10px;">
                    <h3 style="color: #dc3545; margin-bottom: 10px;">üòî Mayor Goleada en Contra</h3>
                    <p><strong>${match.strHomeTeam} ${match.intHomeScore} - ${match.intAwayScore} ${match.strAwayTeam}</strong></p>
                    <p>Diferencia: ${biggestLoss.diff} goles</p>
                </div>`;
            }

            html += '</div>';
            container.innerHTML = html;
        }

        function displayTeamInfo(team) {
            const container = document.getElementById('teamInfo');
            container.innerHTML = `
                <div style="padding: 20px;">
                    <div style="text-align: center; margin-bottom: 30px;">
                        <img src="${team.strBadge}" alt="Escudo" style="width: 150px; height: 150px; margin-bottom: 20px;">
                        <h2 style="color: #00A651;">${team.strTeam}</h2>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-label">Fundado</div>
                            <div class="stat-value" style="font-size: 24px;">${team.intFormedYear}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Estadio</div>
                            <div class="stat-value" style="font-size: 18px;">${team.strStadium}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Capacidad</div>
                            <div class="stat-value" style="font-size: 24px;">${team.intStadiumCapacity}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Ciudad</div>
                            <div class="stat-value" style="font-size: 18px;">${team.strLocation}</div>
                        </div>
                    </div>
                    <div style="margin-top: 30px; padding: 20px; background: #f5f5f5; border-radius: 10px;">
                        <h3 style="color: #00A651; margin-bottom: 15px;">Enlaces Oficiales</h3>
                        <p><a href="https://${team.strWebsite}" target="_blank" style="color: #00A651;">üåê Sitio Web</a></p>
                        <p><a href="https://${team.strFacebook}" target="_blank" style="color: #00A651;">üìò Facebook</a></p>
                        <p><a href="https://${team.strTwitter}" target="_blank" style="color: #00A651;">üê¶ Twitter</a></p>
                        <p><a href="https://${team.strInstagram}" target="_blank" style="color: #00A651;">üì∑ Instagram</a></p>
                    </div>
                </div>
            `;
        }

        function showLoading() {
            document.getElementById('loading').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loading').classList.add('hidden');
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
        }

        function hideError() {
            document.getElementById('error').classList.add('hidden');
        }
    </script>
</body>
</html>
